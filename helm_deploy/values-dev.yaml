# Per environment values which override defaults in hmpps-education-and-work-plan/values.yaml

generic-service:
  replicaCount: 2

  ingress:
    host: learning-and-work-progress-dev.hmpps.service.justice.gov.uk
    modsecurity_snippet: |
      SecRuleEngine On
      # GitHub team name to grant access to the OpenSearch logs to be able to delve into the detail and cause
      SecDefaultAction "phase:2,pass,log,tag:github_team=farsight-devs"
      # Change default response code to be a 406 so that we can tell easily that it is modsecurity doing the blocking
      SecRuleUpdateActionById 949110 "t:none,deny,status:406,logdata:%{SERVER_NAME}"
      SecRuleUpdateActionById 959100 "t:none,deny,status:406,logdata:%{SERVER_NAME}"
      # Update OWASP rule 942440 (SQL Comment injection via ==) to not apply it to the connect.sid cookie (express) or the _csrf token. Both can legitimately include ==
      SecRuleUpdateTargetById 942440 "!REQUEST_COOKIES:/connect.sid/" 
      SecRuleUpdateTargetById 942440 "!ARGS:_csrf"
      # Disable OWASP rule 942230 (SQL injection attempt) as the regex is too strict and prevents sentences containing `case`, `like`, `having` or `if` in them
      SecRuleRemoveById 942230
      SecRuleUpdateActionById 921110 "setvar:'tx.anomaly_score_pl1=+5'"

  scheduledDowntime:
    enabled: true
    startup: '30 6 * * 1-5' # Start at 6.30am UTC Monday-Friday
    shutdown: '00 21 * * 1-5' # Stop at 9.00pm UTC Monday-Friday

  env:
    INGRESS_URL: "https://learning-and-work-progress-dev.hmpps.service.justice.gov.uk"
    HMPPS_AUTH_URL: "https://sign-in-dev.hmpps.service.justice.gov.uk/auth"
    TOKEN_VERIFICATION_API_URL: "https://token-verification-api-dev.prison.service.justice.gov.uk"
    EDUCATION_AND_WORK_PLAN_API_URL: "https://learningandworkprogress-api-dev.hmpps.service.justice.gov.uk"
    PRISONER_SEARCH_API_URL: "https://prisoner-search-dev.prison.service.justice.gov.uk"
    PRISON_REGISTER_API_URL: "https://prison-register-dev.hmpps.service.justice.gov.uk"
    CURIOUS_API_URL: "https://testservices.sequation.net/sequation-virtual-campus2-api"
    CIAG_INDUCTION_UI_URL: "https://ciag-induction-dev.hmpps.service.justice.gov.uk"
    DPS_URL: "https://digital-dev.prison.service.justice.gov.uk"
    FRONTEND_COMPONENT_API_URL: "https://frontend-components-dev.hmpps.service.justice.gov.uk"
    ENVIRONMENT_NAME: "DEV"

  allowlist:
    uservision-accessibility-testers: 5.181.59.114/32
    cymulate-1: 54.217.50.18/32
    cymulate-2: 52.208.202.111/32
    cymulate-3: 52.49.144.209/32
    groups:
      - internal
      - prisons
      - private_prisons

generic-prometheus-alerts:
  alertSeverity: digital-prison-service-dev
