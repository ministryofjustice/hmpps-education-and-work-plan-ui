{% extends "../../partials/layout.njk" %}
{% from "./macros/sortableTable.njk" import sortableTable %}

{% set pageTitle = "Prisoner's functional skills" %}

{% set pageId = "functional-skills" %}

{% block beforeContent %}
  <nav class="govuk-breadcrumbs govuk-!-display-none-print" aria-label="Breadcrumb">
    <ol class="govuk-breadcrumbs__list">
      <li class="govuk-breadcrumbs__list-item">
        <a class="govuk-breadcrumbs__link" href="{{ dpsUrl }}">Digital Prison Services</a>
      </li>
      <li class="govuk-breadcrumbs__list-item">
        <a class="govuk-breadcrumbs__link" href="{{ prisonerListUrl }}">Manage learning and work progress</a>
      </li>
      <li class="govuk-breadcrumbs__list-item">
        <a class="govuk-breadcrumbs__link" href="/plan/{{ prisonerSummary.prisonNumber }}/view/education-and-training" data-id="breadcrumbs-prisoner-{{ prisonerSummary.prisonNumber }}">{{ prisonerSummary.firstName }} {{ prisonerSummary.lastName }}'s learning and work progress</a>
      </li>
    </ol>
  </nav>
{% endblock %}

{% block content %}

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds app-u-print-full-width">
        <span class="govuk-caption-l">Learning and work progress</span>
        <h1 class="govuk-heading-l">{{ prisonerSummary.firstName }} {{ prisonerSummary.lastName }}'s functional skills initial assessment results</h1>
      </div>
      <div class="govuk-grid-column-one-third">
        {% include "../../partials/printThisPage.njk" %}
      </div>
    </div>

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        {% include "../../partials/prisonerBanner.njk" %}
      </div>
    </div>

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">

        {% if prisonerFunctionalSkills.isFulfilled() %}
          {% set prisonerFunctionalSkills = prisonerFunctionalSkills.value %}
          {% set prisonNamesById = prisonNamesById.value if prisonNamesById.isFulfilled() else {} %}
          {% set englishSkills = prisonerFunctionalSkills.assessments | filterArrayOnProperty('type', 'ENGLISH') | sort(attribute = 'assessmentDate', reverse = true) %}
          {% set mathsSkills = prisonerFunctionalSkills.assessments | filterArrayOnProperty('type', 'MATHS') | sort(attribute = 'assessmentDate', reverse = true) %}
          {% set digitalSkills = prisonerFunctionalSkills.assessments | filterArrayOnProperty('type', 'DIGITAL_LITERACY') | sort(attribute = 'assessmentDate', reverse = true) %}
          {% set readingSkills = prisonerFunctionalSkills.assessments | filterArrayOnProperty('type', 'READING') | sort(attribute = 'assessmentDate', reverse = true) %}
          {% set esolSkills = prisonerFunctionalSkills.assessments | filterArrayOnProperty('type', 'ESOL') | sort(attribute = 'assessmentDate', reverse = true) %}

          <p class="govuk-hint">Information from Curious. These results are from a person's induction assessment.
            For recent functional skills qualifications, go to
            <a class="govuk-link" href="/plan/{{ prisonerSummary.prisonNumber }}/in-prison-courses-and-qualifications" data-qa="view-all-in-prison-courses-link">in-prison courses and qualifications</a>.
          </p>
        </div>
      </div>

      <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">

          <h2 class="govuk-heading-m">English skills</h2>
          {% if englishSkills.length > 0 %}
            {{ sortableTable({
              id: "english-skills",
              prisonNamesById: prisonNamesById,
              assessments: englishSkills
            }) }}
          {% else %}
            <p class="govuk-body">No English functional skill assessment result recorded in Curious.</p>
          {% endif %}

          <h2 class="govuk-heading-m">Maths skills</h2>
          {% if mathsSkills.length > 0 %}
            {{ sortableTable({
              id: "maths-skills",
              prisonNamesById: prisonNamesById,
              assessments: mathsSkills
            }) }}
          {% else %}
            <p class="govuk-body">No Maths functional skill assessment result recorded in Curious.</p>
          {% endif %}

          <h2 class="govuk-heading-m">Digital skills</h2>
          {% if digitalSkills.length > 0 %}
            {{ sortableTable({
              id: "digital-skills",
              prisonNamesById: prisonNamesById,
              assessments: digitalSkills
            }) }}
          {% else %}
            <p class="govuk-body">No Digital functional skill assessment result recorded in Curious.</p>
          {% endif %}

          <h2 class="govuk-heading-m">Reading scores</h2>
          {% if readingSkills.length > 0 %}
            {{ sortableTable({
              id: "reading-skills",
              prisonNamesById: prisonNamesById,
              assessments: readingSkills
            }) }}
          {% else %}
            <p class="govuk-body">No Reading assessment result recorded in Curious.</p>
          {% endif %}

          <h2 class="govuk-heading-m">ESOL scores</h2>
          {% if esolSkills.length > 0 %}
            {{ sortableTable({
              id: "esol-skills",
              prisonNamesById: prisonNamesById,
              assessments: esolSkills
            }) }}
          {% else %}
            <p class="govuk-body">No ESOL assessment result recorded in Curious.</p>
          {% endif %}

        {% else %}

          <h2 class="govuk-heading-m" data-qa="curious-unavailable-message">We cannot show these details from Curious right now</h2>
          <p class="govuk-body">Reload the page or try again later. Other parts of this service may still be available.</p>

        {% endif %}

      </div>
    </div>
{% endblock %}
